<ng-container *ngIf="club$ | async as club">
  <ion-header [translucent]="true">
    <ion-toolbar>
      <ng-container *ngIf="clubAdminList$ | async as clubAdminList">
        <ion-buttons
          *ngIf="isClubAdmin(clubAdminList, club.id)"
          slot="secondary"
        >
          <ion-button *ngIf="!allowEdit" (click)="edit()"
            >{{"common.edit" | translate}}</ion-button
          >
          <ion-button *ngIf="allowEdit" (click)="edit()"
            >{{"common.done" | translate}}</ion-button
          >
        </ion-buttons>
      </ng-container>
      <ion-title>{{"club.links" | translate}}</ion-title>
      <ion-buttons slot="end">
        <ion-button (click)="close()"
          >{{"common.close" | translate}}</ion-button
        >
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <ion-content [fullscreen]="true">
    <ion-header collapse="condense">
      <ion-toolbar>
        <ion-title size="large">{{"club.links" | translate}}</ion-title>
      </ion-toolbar>
    </ion-header>

    <ion-list [inset]="true" *ngIf="links$ | async as links else loading">
      <ion-reorder-group
        (ionItemReorder)="doReorder($event)"
        [disabled]="!allowEdit"
      >
        <ion-item-group>
          <ion-item-sliding *ngFor="let link of links">
            <ion-item detail="true" (click)="openLink(link.url)">
              <ion-reorder slot="start" *ngIf="allowEdit"></ion-reorder>
              <ion-icon [name]="getLinkIcon(link.type)" slot="start"></ion-icon>
              <ion-label class="ion-text-wrap">
                <h2>{{link.title}}</h2>
                <p>{{link.description.slice(0, 50)}}...</p>
              </ion-label>
            </ion-item>
            <ng-container *ngIf="clubAdminList$ | async as clubAdminList">
              <ng-container *ngIf="isClubAdmin(clubAdminList, club.id)">
                <ion-item-options side="end">
                  <ion-item-option color="primary" (click)="editLink(link)">
                    <ion-icon slot="icon-only" name="create-outline"></ion-icon>
                  </ion-item-option>
                  <ion-item-option color="danger" (click)="deleteLink(link.id)">
                    <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
                  </ion-item-option>
                </ion-item-options>
              </ng-container>
            </ng-container>
          </ion-item-sliding>
        </ion-item-group>
      </ion-reorder-group>
    </ion-list>

    <ng-container *ngIf="clubAdminList$ | async as clubAdminList">
      <ion-fab
        *ngIf="isClubAdmin(clubAdminList, club.id)"
        vertical="bottom"
        horizontal="end"
        slot="fixed"
      >
        <ion-fab-button (click)="isAddingLink = true">
          <ion-icon name="add"></ion-icon>
        </ion-fab-button>
      </ion-fab>
    </ng-container>
  </ion-content>
</ng-container>

<ng-template #loading>
  <ion-list [inset]="true">
    <ion-item-group>
      <ion-item-divider color="light">
        <ion-label
          ><ion-skeleton-text animated style="width: 20%"></ion-skeleton-text
        ></ion-label>
      </ion-item-divider>

      <!-- Link 1 -->
      <ion-item>
        <ion-icon slot="start">
          <ion-skeleton-text animated></ion-skeleton-text>
        </ion-icon>
        <ion-label>
          <ion-skeleton-text animated style="width: 70%"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
        </ion-label>
      </ion-item>

      <!-- Link 2 -->
      <ion-item>
        <ion-icon slot="start">
          <ion-skeleton-text animated></ion-skeleton-text>
        </ion-icon>
        <ion-label>
          <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 40%"></ion-skeleton-text>
        </ion-label>
      </ion-item>
    </ion-item-group>
  </ion-list>
</ng-template>

<ion-modal [isOpen]="isAddingLink">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>{{"club.add_link" | translate}}</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="isAddingLink = false"
            >{{"common.cancel" | translate}}</ion-button
          >
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="ion-padding">
      <ion-list>
        <ion-item>
          <ion-label position="stacked"
            >{{"club.link_title" | translate}}</ion-label
          >
          <ion-input [(ngModel)]="newLink.title" type="text"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked"
            >{{"club.link_description" | translate}}</ion-label
          >
          <ion-textarea
            [(ngModel)]="newLink.description"
            rows="3"
          ></ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label position="stacked"
            >{{"club.link_type" | translate}}</ion-label
          >
          <ion-select [(ngModel)]="newLink.type">
            <ion-select-option value="web"
              >{{"club.link_type_web" | translate}}</ion-select-option
            >
            <ion-select-option value="image"
              >{{"club.link_type_image" | translate}}</ion-select-option
            >
            <ion-select-option value="pdf"
              >{{"club.link_type_pdf" | translate}}</ion-select-option
            >
          </ion-select>
        </ion-item>

        <ion-item *ngIf="newLink.type === 'web'">
          <ion-label position="stacked"
            >{{"club.link_url" | translate}}</ion-label
          >
          <ion-input [(ngModel)]="newLink.url" type="url"></ion-input>
        </ion-item>

        <ion-item *ngIf="newLink.type === 'image' || newLink.type === 'pdf'">
          <ion-label position="stacked"
            >{{"club.link_file" | translate}}</ion-label
          >
          <ion-input type="file" (change)="onFileSelected($event)"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label>{{"club.show_on_card" | translate}}</ion-label>
          <ion-checkbox [(ngModel)]="newLink.showOnCard"></ion-checkbox>
        </ion-item>
      </ion-list>

      <ion-button
        expand="block"
        (click)="addLink()"
        [disabled]="!isValidLink()"
      >
        {{"common.save" | translate}}
      </ion-button>
    </ion-content>
  </ng-template>
</ion-modal>
