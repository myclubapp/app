<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>{{"common.details" | translate}} </ion-title>
    <ion-buttons slot="primary">
      <ion-button (click)="close()">{{"common.close" | translate}}</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">{{"common.details" | translate}}</ion-title>
    </ion-toolbar>
  </ion-header>

  <ng-container *ngIf="event$ | async as event; else noEvent">

    <ion-list [inset]="true">
      <ion-item>
        <ion-icon slot="start" name="home-outline"></ion-icon>
        <ion-label class="ion-text-wrap">
          <h2>{{event.name}}</h2>
        </ion-label>
      </ion-item>

      <ion-item>
        <ion-icon slot="start" name="calendar-outline"></ion-icon>
        <ion-label>
          <h2>
            {{event.date.toDate() | date:'dd.MM.YYYY '}} {{event.timeFrom |
            date:'HH:mm'}} Uhr - {{event.timeTo | date:'HH:mm'}} Uhr
          </h2>
        </ion-label>
      </ion-item>

      <ion-item>
        <ion-icon slot="start" name="location-outline"></ion-icon>
        <ion-label class="ion-text-wrap">
          <h2>{{event.streetAndNumber}} {{event.city}}</h2>
        </ion-label>
      </ion-item>

      <ion-item>
        <ion-icon slot="start" name="information-circle-outline"></ion-icon>
        <ion-label class="ion-text-wrap">
          <h2>{{event.description}}</h2>
        </ion-label>
      </ion-item>

      <ion-item *ngIf="event.link_web">
        <ion-icon slot="start" name="link-outline"></ion-icon>
        <ion-label class="ion-text-wrap">
          <h2>{{event.link_web}}</h2>
        </ion-label>
        <ion-button slot="end" (click)="openUrl(event.link_web)" fill="clear">
          <ion-icon slot="icon-only" name="open-outline"></ion-icon>
        </ion-button>
      </ion-item>

      <ion-item *ngIf="event.link_poll">
        <ion-icon slot="start" name="help-circle-outline"></ion-icon>
        <ion-label class="ion-text-wrap">
          <h2>{{event.link_poll}}</h2>
        </ion-label>
        <ion-button slot="end" (click)="openUrl(event.link_poll)" fill="clear">
          <ion-icon slot="icon-only" name="open-outline"></ion-icon>
        </ion-button>
      </ion-item>
    </ion-list>

    <ng-container *ngIf="schichten$ | async as schichten">

      <!-- Helfereinsätze MIT Schichten -->
      <ion-list lines="full" [inset]="true" *ngIf="schichten.length > 0">
        <ion-list-header>
          <ion-label> {{"helfer.schichten" | translate}} </ion-label>
          <!-- BESTàTIGEN, FALLS CLUBADMIN -->
          <ng-container *ngIf="clubAdminList$ | async as clubAdminList">
            <ion-button (click)="confirmSchichten()" *ngIf="isClubAdmin(clubAdminList, event.clubId)"> bestätigen
            </ion-button>
          </ng-container>
        </ion-list-header>
        <ng-container *ngFor="let schicht of schichten">
          <ion-item>
            <ng-container *ngIf="!schicht.confirmed && isFuture">
              <ion-icon *ngIf="schicht.status === null" slot="icon-only" color="warning" slot="start" name="help-circle"
                (click)="toggleSchicht(true, schicht)"></ion-icon>
              <ion-icon *ngIf="schicht.status === true" slot="icon-only" color="success" slot="start"
                name="checkmark-circle" (click)="toggleSchicht(false, schicht)"></ion-icon>

              <ion-icon *ngIf="schicht.status === false" slot="icon-only" color="danger" slot="start"
                name="close-circle" (click)="toggleSchicht(true, schicht)"></ion-icon>
            </ng-container>
            <ng-container *ngIf="!isFuture || schicht.confirmed">
              <ion-icon *ngIf="schicht.status === null" slot="icon-only" color="warning" slot="start"
                name="help-circle"></ion-icon>
              <ion-icon *ngIf="schicht.status === true" slot="icon-only" color="success" slot="start"
                name="checkmark-circle"></ion-icon>
              <ion-icon *ngIf="schicht.status === false" slot="icon-only" color="danger" slot="start"
                name="close-circle"></ion-icon>
            </ng-container>
            <ion-label>
              <h2>{{schicht.name}}</h2>
              <h3>{{schicht.timeFrom}} {{schicht.timeTo}}</h3>
              <h3>{{'common.helper_points'| translate}}: {{schicht.points}}</h3>
            </ion-label>
            <ion-badge>{{schicht.attendeeListTrue.length}} /
              {{schicht.countNeeded}}
            </ion-badge>
          </ion-item>
          <ion-accordion-group expand="inset" *ngIf="schicht['attendeeListTrue'].length > 0">
            <ion-accordion value="yes">
              <ion-item slot="header" color="light">
                <ion-label>{{"helfer-detail.helfer_innen_for" | translate}} {{schicht.name}}</ion-label>
              </ion-item>
              <div slot="content">
                <!-- class="ion-padding"-->
                <ion-list>
                  <ion-item *ngFor="let member of schicht['attendeeListTrue']" detail="true">
                    <ion-icon *ngIf="member.confirmed" color="primary" slot="start" name="checkmark-circle-outline">
                    </ion-icon>
                    <!--<ion-icon *ngIf="!member.confirmed" color="primary" slot="start" name="help-buoy">
                    </ion-icon>-->

                    <ion-label (click)="openMember(member)">{{member.firstName}} {{member.lastName}}</ion-label>
                  </ion-item>
                </ion-list>
              </div>

            </ion-accordion>
          </ion-accordion-group>

        </ng-container>
      </ion-list>

      <!-- Helfereinsätze OHNE Schichten MY STATUS-->
      <ion-list [inset]="true" lines="none" *ngIf="schichten.length == 0 && isFuture">
        <ion-list-header>
          {{"common.attendances__absences" | translate}}
        </ion-list-header>
        <ion-item class="myclubStatus">
          <ng-container *ngIf="event.hasOwnProperty('status'); else loading">
            <ion-fab-button (click)="toggle(true, event)" size="small" color="warning" slot="start"
              *ngIf="event.status === null">
              <ion-icon name="help-circle"> </ion-icon>
            </ion-fab-button>

            <ion-fab-button (click)="toggle(true, event)" size="small" color="danger" slot="start"
              *ngIf="event.status === false">
              <ion-icon name="close-circle"> </ion-icon>
            </ion-fab-button>

            <ion-fab-button (click)="toggle(false, event)" size="small" color="success" slot="start"
              *ngIf="event.status === true">
              <ion-icon name="checkmark-circle"> </ion-icon>
            </ion-fab-button>
          </ng-container>
          <ion-label>{{"common.my__status" | translate}}</ion-label>

        </ion-item>
      </ion-list>

      <ion-list [inset]="true" *ngIf="schichten.length == 0">
        <ion-accordion-group>
          <ion-accordion value="yes">
            <ion-item slot="header" color="light">
              <ion-label>{{"common.present" | translate}}:
                {{event['attendeeListTrue']?.length}}</ion-label>
            </ion-item>
            <div slot="content">
              <ion-list>
                <ion-item *ngFor="let member of event['attendeeListTrue']" detail="true">
                  <ion-icon color="success" slot="start" name="checkmark-circle">
                  </ion-icon>
                  <ion-label (click)="openMember(member)">{{member.firstName}} {{member.lastName}}</ion-label>
                </ion-item>
              </ion-list>
            </div>
          </ion-accordion>
          <ion-accordion value="no">
            <ion-item slot="header" color="light">
              <ion-label>{{"common.absent" | translate}}:
                {{event['attendeeListFalse']?.length}}</ion-label>
            </ion-item>
            <div slot="content">
              <ion-list>
                <ion-item *ngFor="let member of event['attendeeListFalse']" detail="true">
                  <ion-icon color="danger" slot="start" name="close-circle">
                  </ion-icon>

                  <ion-label (click)="openMember(member)">{{member.firstName}} {{member.lastName}}</ion-label>
                </ion-item>
              </ion-list>
            </div>
          </ion-accordion>
          <ion-accordion value="null">
            <ion-item slot="header" color="light">
              <ion-label>{{"common.noreply" | translate}}:
                {{event['unrespondedMembers'].length}}</ion-label>
            </ion-item>
            <div slot="content">
              <!-- class="ion-padding"-->
              <ion-list>
                <ion-item *ngFor="let member of event['unrespondedMembers']" detail="true">
                  <ion-icon color="warning" slot="start" name="help-circle">
                  </ion-icon>

                  <ion-label (click)="openMember(member)">{{member.firstName}} {{member.lastName}}</ion-label>
                </ion-item>
              </ion-list>
            </div>
          </ion-accordion>
        </ion-accordion-group>
      </ion-list>
    </ng-container>
  </ng-container>
</ion-content>

<ng-template #noEvent>
  <ion-content class="ion-padding">
    <ion-text>
      Nichts gefunden
    </ion-text>
  </ion-content>
</ng-template>

<ng-template #loading>
  <ion-skeleton-text animated style="width: 10%"></ion-skeleton-text>
  <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
</ng-template>