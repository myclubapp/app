@if (event$ | async; as event) {
<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="secondary">
      <ion-button (click)="close()">{{"common.close" | translate}}</ion-button>
    </ion-buttons>
    <ion-title>{{"common.details" | translate}} </ion-title>
    <ion-buttons slot="primary">
      @if (clubAdminList$ | async; as clubAdminList) { @if
      (isClubAdmin(clubAdminList, event.clubId)) { @if (!allowEdit) {
      <ion-button strong="true" (click)="edit()"
        >{{"common.edit" | translate}}</ion-button
      >
      } @if (allowEdit) {
      <ion-button strong="true" (click)="edit()"
        >{{"common.done" | translate}}</ion-button
      >
      } } }
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">{{"common.details" | translate}}</ion-title>
      <ion-buttons slot="end">
        @if (clubAdminList$ | async; as clubAdminList) { @if
        (isClubAdmin(clubAdminList, event.clubId)) {
        <ion-button (click)="openAdminActions()">
          <ion-icon
            slot="icon-only"
            ios="ellipsis-horizontal"
            md="ellipsis-vertical"
          ></ion-icon>
        </ion-button>
        } }
      </ion-buttons>
    </ion-toolbar>
  </ion-header>
  @if (!allowEdit) {
  <ion-list [inset]="true">
    <ion-item>
      <ion-icon slot="start" name="home-outline"></ion-icon>
      <ion-label class="ion-text-wrap">
        <h2>{{event.name}}</h2>
      </ion-label>
    </ion-item>
    <ion-item>
      <ion-icon slot="start" name="calendar-outline"></ion-icon>
      <ion-label>
        <h2>
          {{event.date.toDate() | date:'dd.MM.yyyy'}} {{event.timeFrom |
          date:'HH:mm'}} Uhr - {{event.timeTo | date:'HH:mm'}} Uhr
        </h2>
      </ion-label>
    </ion-item>
    <ion-item>
      <ion-icon slot="start" name="location-outline"></ion-icon>
      <ion-label class="ion-text-wrap">
        <h2>{{event.location}}</h2>
        <h2>{{event.streetAndNumber}}</h2>
        <h2>{{event.postalCode}} {{event.city}}</h2>
      </ion-label>
    </ion-item>
    <ion-item>
      <ion-icon slot="start" name="information-circle-outline"></ion-icon>
      <ion-label class="ion-text-wrap">
        <h2>{{event.description}}</h2>
      </ion-label>
    </ion-item>
    @if (event.link_web) {
    <ion-item>
      <ion-icon slot="start" name="link-outline"></ion-icon>
      <ion-label class="ion-text-wrap">
        <h2>{{event.link_web}}</h2>
      </ion-label>
      <ion-button slot="end" (click)="openUrl(event.link_web)" fill="clear">
        <ion-icon slot="icon-only" name="open-outline"></ion-icon>
      </ion-button>
    </ion-item>
    } @if (event.link_poll) {
    <ion-item>
      <ion-icon slot="start" name="help-circle-outline"></ion-icon>
      <ion-label class="ion-text-wrap">
        <h2>{{event.link_poll}}</h2>
      </ion-label>
      <ion-button slot="end" (click)="openUrl(event.link_poll)" fill="clear">
        <ion-icon slot="icon-only" name="open-outline"></ion-icon>
      </ion-button>
    </ion-item>
    }
  </ion-list>
  } @if (!allowEdit) { @if (schichten$ | async; as schichten) {
  <!-- Helfereinsätze MIT Schichten -->
  @if (schichten.length > 0) {
  <ion-list lines="full" [inset]="true">
    <ion-list-header>
      <ion-label> {{"helfer.schichten" | translate}} </ion-label>
      <!-- BESTàTIGEN, FALLS CLUBADMIN -->
      @if (clubAdminList$ | async; as clubAdminList) { @if
      (isClubAdmin(clubAdminList, event.clubId)) {
      <ion-button (click)="confirmSchichten()"> bestätigen </ion-button>
      } }
    </ion-list-header>
    @for (schicht of schichten; track schicht.id) {
    <ion-item-sliding #item>
      <ion-item>
        <!-- Zeige Status-Icon NUR wenn keine Kinder vorhanden sind -->
        @if (!schicht.children || schicht.children.length === 0) { @if
        (schicht.status.length > 0 && schicht.status[0]) {
        <!-- User hat bereits einen Status -->
        @if (schicht.status[0].status === null || schicht.status[0].status ===
        undefined) {
        <ion-icon
          slot="start"
          color="warning"
          name="help-circle"
          (click)="isFuture && !schicht.confirmed && onSchichtIconClick(item, true, event, schicht)"
        ></ion-icon>
        } @if (schicht.status[0].status === false) {
        <ion-icon
          slot="start"
          color="danger"
          name="close-circle"
          (click)="isFuture && !schicht.confirmed && onSchichtIconClick(item, true, event, schicht)"
        ></ion-icon>
        } @if (schicht.status[0].status === true) {
        <ion-icon
          slot="start"
          color="success"
          name="checkmark-circle"
          (click)="isFuture && !schicht.confirmed && onSchichtIconClick(item, false, event, schicht)"
        ></ion-icon>
        } } @else {
        <!-- User hat noch keinen Status -->
        <ion-icon
          slot="start"
          color="warning"
          name="help-circle"
          (click)="isFuture && !schicht.confirmed && onSchichtIconClick(item, true, event, schicht)"
        ></ion-icon>
        } }
        <ion-label>
          <h2>{{schicht.name}}</h2>
          <h3>Zeit: {{schicht.timeFrom}} Uhr - {{schicht.timeTo}} Uhr</h3>
          <h3>{{'common.helper_points'| translate}}: {{schicht.points}}</h3>
        </ion-label>
        <ion-badge
          >{{schicht.attendeeListTrue.length}} / {{schicht.countNeeded}}
        </ion-badge>
      </ion-item>
      @if (clubAdminList$ | async; as clubAdminList) { @if
      (isClubAdmin(clubAdminList, event.clubId)) {
      <ion-item-options side="end">
        <ion-item-option
          color="primary"
          (click)="addMembersToSchicht(item, schicht)"
        >
          <ion-icon slot="icon-only" name="person-add"></ion-icon>
        </ion-item-option>
      </ion-item-options>
      } }
    </ion-item-sliding>

    <!-- Kinder anzeigen (wie auf der Trainings-Seite) -->
    @if (schicht.children && schicht.children.length > 0) { @for (child of
    schicht.children; track child.id) {
    <ion-item-sliding #childItem>
      <ion-item>
        @if (child.status !== true && child.status !== false) {
        <ion-icon
          slot="start"
          color="warning"
          name="help-circle"
          (click)="isFuture && !schicht.confirmed && onChildIconClick(childItem, true, event, schicht, child.id)"
        ></ion-icon>
        } @if (child.status === false) {
        <ion-icon
          slot="start"
          color="danger"
          name="close-circle"
          (click)="isFuture && !schicht.confirmed && onChildIconClick(childItem, true, event, schicht, child.id)"
        ></ion-icon>
        } @if (child.status === true) {
        <ion-icon
          slot="start"
          color="success"
          name="checkmark-circle"
          (click)="isFuture && !schicht.confirmed && onChildIconClick(childItem, false, event, schicht, child.id)"
        ></ion-icon>
        }
        <ion-label>{{child.firstName}} {{child.lastName}}</ion-label>
      </ion-item>
    </ion-item-sliding>
    } } @if (schicht['attendeeListTrue'].length > 0) {
    <ion-accordion-group expand="inset">
      <ion-accordion value="yes">
        <ion-item slot="header" color="light">
          <ion-label
            >{{"helfer-detail.helfer_innen_for" | translate}}
            {{schicht.name}}</ion-label
          >
        </ion-item>
        <div slot="content">
          <ion-list>
            @for (member of schicht['attendeeListTrue']; track member.id) {
            <ion-item-sliding #item>
              <ion-item detail="true">
                @if (member.confirmed) {
                <ion-icon
                  color="primary"
                  slot="start"
                  name="checkmark-circle-outline"
                ></ion-icon>
                }
                <ion-label (click)="openMember(member)">
                  <h2>{{member.firstName}} {{member.lastName}}</h2>
                  <p>
                    {{member?.changedAt?.toDate() | date:'dd.MM.yyyy HH:mm'}}
                  </p>
                </ion-label>
              </ion-item>
              @if (clubAdminList$ | async; as clubAdminList) { @if
              (isClubAdmin(clubAdminList, event.clubId)) {
              <ion-item-options side="end">
                @if (member.status === false || member.status === null) {
                <ion-item-option
                  color="success"
                  (click)="toggleSchichtItem(item, true, event, schicht, member.id)"
                >
                  <ion-icon slot="icon-only" name="checkmark-circle"></ion-icon>
                </ion-item-option>
                } @if (member.status === true || member.status === null) {
                <ion-item-option
                  color="danger"
                  (click)="toggleSchichtItem(item, false, event, schicht, member.id)"
                >
                  <ion-icon slot="icon-only" name="close-circle"></ion-icon>
                </ion-item-option>
                }
              </ion-item-options>
              } }
            </ion-item-sliding>
            }
          </ion-list>
        </div>
      </ion-accordion>
    </ion-accordion-group>
    } }
  </ion-list>
  } } }
  <!-- CHANGE MODE-->
  @if (allowEdit) {
  <ion-list [inset]="true">
    <ion-item>
      <ion-input
        [label]='"common.name" | translate'
        label-placement="stacked"
        (ionChange)="updateEvent($event, 'name')"
        [value]="event.name"
      >
      </ion-input>
    </ion-item>
    <ion-item>
      <ion-textarea
        [autoGrow]="true"
        (ionChange)="updateEvent($event, 'description')"
        [label]='"common.description" | translate'
        label-placement="stacked"
        [value]="event.description"
      >
      </ion-textarea>
    </ion-item>
  </ion-list>
  <ion-list [inset]="true">
    <ion-item>
      <ion-input
        (ionChange)="updateEvent($event, 'location')"
        [label]='"common.location" | translate'
        label-placement="stacked"
        [value]="event.location"
      >
      </ion-input>
    </ion-item>
    <ion-item>
      <ion-input
        (ionChange)="updateEvent($event, 'streetAndNumber')"
        [label]='"common.street__house_number" | translate'
        label-placement="stacked"
        [value]="event.streetAndNumber"
      >
      </ion-input>
    </ion-item>
    <ion-item>
      <ion-input
        (ionChange)="updateEvent($event, 'postalCode')"
        [label]="'common.postal__code' | translate"
        label-placement="stacked"
        [value]="event.postalCode"
      >
      </ion-input>
    </ion-item>
    <ion-item>
      <ion-input
        (ionChange)="updateEvent($event, 'city')"
        [label]='"common.locality" | translate'
        label-placement="stacked"
        [value]="event.city"
      >
      </ion-input>
    </ion-item>
  </ion-list>
  <ion-list [inset]="true">
    <ion-item>
      <ion-input
        (ionChange)="updateEvent($event, 'link_web')"
        [label]="'common.link__web' | translate"
        label-placement="stacked"
        type="url"
        [value]="event.link_web"
        [placeholder]="'common.link__placeholder' | translate"
      >
      </ion-input>
    </ion-item>
    <ion-item>
      <ion-input
        (ionChange)="updateEvent($event, 'link_poll')"
        [label]="'common.link__poll' | translate"
        label-placement="stacked"
        type="url"
        [value]="event.link_poll"
        [placeholder]="'common.link__placeholder' | translate"
      >
      </ion-input>
    </ion-item>
  </ion-list>
  <!--<ion-list [inset]="true">
                <ion-item id="timeFromItem">
                  <ion-label position="">
                    {{"common.start__event" | translate}}:
                  </ion-label>
                  <ion-datetime-button slot="end" datetime="timeFrom"></ion-datetime-button>
                  <ion-modal [keepContentsMounted]="true">
                    <ng-template>
                      <ion-datetime presentation="time" id="timeFrom" (ionChange)="changeTimeFrom($event)"
                        (ionChange)="updateEvent($event, 'timeFrom')" minuteValues="0,5,10,15,20,25,30,35,40,45,50,55"
                      [value]="event.timeFrom"></ion-datetime>
                    </ng-template>
                  </ion-modal>
                </ion-item>
                <ion-item id="timeToItem">
                  <ion-label position=""> {{"common.end__event" | translate}}: </ion-label>
                  <ion-datetime-button slot="end" datetime="timeTo"></ion-datetime-button>
                  <ion-modal [keepContentsMounted]="true">
                    <ng-template>
                      <ion-datetime (ionChange)="updateEvent($event, 'timeTo')" presentation="time" id="timeTo"
                      minuteValues="0,5,10,15,20,25,30,35,40,45,50,55" [value]="event.timeTo"></ion-datetime>
                    </ng-template>
                  </ion-modal>
                </ion-item>
                <ion-item id="startDateItem">
                  <ion-label position="default">
                    {{"common.start__date" | translate}}:
                  </ion-label>
                  <ion-datetime-button slot="end" datetime="startDate"></ion-datetime-button>
                  <ion-modal [keepContentsMounted]="true">
                    <ng-template>
                      <ion-datetime (ionChange)="updateEvent($event, 'startDate')" [firstDayOfWeek]="1"
                        (ionChange)="changeStartDate($event)" presentation="date" id="startDate"
                      [value]="event.startDate"></ion-datetime>
                    </ng-template>
                  </ion-modal>
                </ion-item>
                <ion-item id="endDateItem">
                  <ion-label position="default">
                    {{"common.end__date" | translate}}:
                  </ion-label>
                  <ion-datetime-button slot="end" datetime="endDate"></ion-datetime-button>
                  <ion-modal [keepContentsMounted]="true">
                    <ng-template>
                      <ion-datetime (ionChange)="updateEvent($event, 'endDate')" [firstDayOfWeek]="1" presentation="date"
                      id="endDate" [value]="event.endDate"></ion-datetime>
                    </ng-template>
                  </ion-modal>
                </ion-item>
              </ion-list>-->
  @if (schichten$ | async; as schichten) {
  <ion-list lines="full" [inset]="true">
    <ion-list-header>
      <ion-label> {{"helfer.schichten" | translate}} </ion-label>
      <ion-button (click)="addSchicht()"
        >{{'helfer-detail.add_shift_button' | translate}}</ion-button
      >
    </ion-list-header>
    @if (schichten.length > 0) { @for (schicht of schichten; track schicht.id) {
    <ion-item>
      <ion-icon
        color="danger"
        (click)="deleteSchicht(schicht)"
        slot="start"
        name="trash"
        size="medium"
      ></ion-icon>
      <ion-icon
        color="primary"
        (click)="copySchicht(schicht)"
        slot="start"
        name="copy"
        size="medium"
      ></ion-icon>
      <ion-label (click)="editSchicht(schicht)">
        <h3>{{schicht.name}}</h3>
        <h2>{{schicht.timeFrom}} Uhr - {{schicht.timeTo}} Uhr</h2>
      </ion-label>
      <ion-badge slot="end">{{schicht.countNeeded}}</ion-badge>
    </ion-item>
    } } @else {
    <ion-item>
      <ion-label>
        <h3><ion-skeleton-text style="width: 60%"></ion-skeleton-text></h3>
        <h2>
          <ion-skeleton-text style="width: 30%"></ion-skeleton-text>
          <ion-skeleton-text style="width: 40%"></ion-skeleton-text>
        </h2>
      </ion-label>
    </ion-item>
    }
  </ion-list>
  } }
  <!-- Support ID-->
  <ion-text class="ion-text-center" color="medium">
    <ion-note>
      <p>Helfer Event ID: {{event.id}}</p>
    </ion-note>
  </ion-text>
</ion-content>
} @else {
<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="secondary">
      <ion-button>
        <ion-skeleton-text
          animated
          style="width: 80px; height: 20px"
        ></ion-skeleton-text>
      </ion-button>
    </ion-buttons>
    <ion-title>
      <ion-skeleton-text animated style="width: 100px"></ion-skeleton-text>
    </ion-title>
    <ion-buttons slot="primary">
      <ion-button>
        <ion-skeleton-text
          animated
          style="width: 80px; height: 20px"
        ></ion-skeleton-text>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">
        <ion-skeleton-text animated style="width: 120px"></ion-skeleton-text>
      </ion-title>
    </ion-toolbar>
  </ion-header>
  <!-- Event Details List -->
  <ion-list [inset]="true">
    <!-- Name -->
    <ion-item>
      <ion-icon slot="start" name="home-outline"></ion-icon>
      <ion-label>
        <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
      </ion-label>
    </ion-item>
    <!-- Date/Time -->
    <ion-item>
      <ion-icon slot="start" name="calendar-outline"></ion-icon>
      <ion-label>
        <ion-skeleton-text animated style="width: 80%"></ion-skeleton-text>
      </ion-label>
    </ion-item>
    <!-- Location -->
    <ion-item>
      <ion-icon slot="start" name="location-outline"></ion-icon>
      <ion-label>
        <ion-skeleton-text animated style="width: 40%"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
      </ion-label>
    </ion-item>
    <!-- Description -->
    <ion-item>
      <ion-icon slot="start" name="information-circle-outline"></ion-icon>
      <ion-label>
        <ion-skeleton-text animated style="width: 90%"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 80%"></ion-skeleton-text>
      </ion-label>
    </ion-item>
  </ion-list>
  <!-- Helper Shifts Section -->
  <ion-list [inset]="true">
    <ion-list-header>
      <ion-label>
        <ion-skeleton-text animated style="width: 120px"></ion-skeleton-text>
      </ion-label>
      <ion-button>
        <ion-skeleton-text
          animated
          style="width: 80px; height: 20px"
        ></ion-skeleton-text>
      </ion-button>
    </ion-list-header>
    <!-- Shift Items -->
    <ion-item>
      <ion-icon slot="start" name="time-outline"></ion-icon>
      <ion-label>
        <ion-skeleton-text animated style="width: 40%"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
      </ion-label>
      <ion-badge slot="end">
        <ion-skeleton-text animated style="width: 30px"></ion-skeleton-text>
      </ion-badge>
    </ion-item>
    <ion-item>
      <ion-icon slot="start" name="time-outline"></ion-icon>
      <ion-label>
        <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 70%"></ion-skeleton-text>
      </ion-label>
      <ion-badge slot="end">
        <ion-skeleton-text animated style="width: 30px"></ion-skeleton-text>
      </ion-badge>
    </ion-item>
    <!-- Helper List Accordion -->
    <ion-accordion-group>
      <ion-accordion value="helpers">
        <ion-item slot="header">
          <ion-label>
            <ion-skeleton-text
              animated
              style="width: 150px"
            ></ion-skeleton-text>
          </ion-label>
        </ion-item>
        <div slot="content">
          <ion-list>
            <ion-item>
              <ion-icon slot="start" name="person-outline"></ion-icon>
              <ion-label>
                <ion-skeleton-text
                  animated
                  style="width: 70%"
                ></ion-skeleton-text>
              </ion-label>
            </ion-item>
            <ion-item>
              <ion-icon slot="start" name="person-outline"></ion-icon>
              <ion-label>
                <ion-skeleton-text
                  animated
                  style="width: 60%"
                ></ion-skeleton-text>
              </ion-label>
            </ion-item>
          </ion-list>
        </div>
      </ion-accordion>
    </ion-accordion-group>
  </ion-list>
</ion-content>
}

<!-- Replace your current loading template with this structure -->
