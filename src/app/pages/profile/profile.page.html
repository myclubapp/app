<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>{{'common.profile' | translate}}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">{{'common.profile' | translate}}</ion-title>
    </ion-toolbar>
  </ion-header>

  <ng-container *ngIf="userProfile$ | async as userProfile">
    <ion-list lines="full" [inset]="true">
      <ion-list-header>
        <ion-label> {{"profile.generally" | translate}} </ion-label>
      </ion-list-header>

      <ion-item>
        <ion-avatar slot="start">
          <img alt="{{userProfile.firstName}}" src="{{userProfile.profilePicture}}" />
        </ion-avatar>
        <ion-label></ion-label>
        <ion-button slot="end" (click)="takePicture()">
          <ion-icon slot="icon-only" name="camera"></ion-icon>
        </ion-button>
      </ion-item>

      <ion-item>
        <ion-input labelPlacement="stacked" [label]='"common.first__name" | translate'
          attr.aria-label='{{"common.first__name" | translate}}' (ionChange)="profileChange($event, 'firstName')"
          [(ngModel)]="userProfile.firstName" value="{{userProfile.firstName}}">
        </ion-input>
      </ion-item>

      <ion-item>
        <ion-input labelPlacement="stacked" [label]='"common.last__name" | translate'
          attr.aria-label='{{"common.last__name" | translate}}' (ionChange)="profileChange($event, 'lastName')"
          [(ngModel)]="userProfile.lastName" value="{{userProfile.lastName}}">
        </ion-input>
      </ion-item>

      <!--<ion-item>
        <ion-input labelPlacement="stacked" [label]='"profile.birthdate" | translate'
          attr.aria-label='{{"profile.birthdate" | translate}}'
          value="{{userProfile.dateOfBirth.toDate() | date:'dd.MM.YYYY '}}">
        </ion-input>
      </ion-item>-->

      <ion-item id="dateOfBirthItem">
        <ion-label position="">
          {{"profile.birthdate" | translate}}:
        </ion-label>
        <ion-datetime-button slot="end" datetime="dateOfBirth"></ion-datetime-button>

        <ion-modal [keepContentsMounted]="true">
          <ng-template>
            <ion-datetime (ionChange)="onDateChange($event)" [firstDayOfWeek]="1" presentation="date" id="dateOfBirth"
              value="{{localDateString}}"></ion-datetime>
          </ng-template>
        </ion-modal>
      </ion-item>

      <ion-item>
        <ion-select aria-label="'profile.language' | translate" [label]="'profile.language' | translate"
          [(ngModel)]="userProfile.language" (ionChange)="profileChange($event, 'language')"
          [placeholder]="'profile.select__language' | translate" [cancelText]="'common.cancel' | translate"
          [okText]="'common.save' | translate">
          <ion-select-option value="de">{{"common.language__german" | translate}}</ion-select-option>
          <ion-select-option value="fr">{{"common.language__french" | translate}}</ion-select-option>
          <ion-select-option value="it">{{"common.language__italian" | translate}}</ion-select-option>
          <ion-select-option value="en">{{"common.language__english" | translate}}</ion-select-option>
        </ion-select>
      </ion-item>
    </ion-list>
    <ion-list lines="full" [inset]="true">
      <ion-list-header>
        <ion-label> {{ "profile.contact__information" | translate}} </ion-label>
      </ion-list-header>

      <ion-item>
        <ion-input labelPlacement="stacked" [label]='"profile.phonenumber" | translate'
          attr.aria-label='{{"profile.phonenumber" | translate}}' [(ngModel)]="userProfile.phonenumber" tel
          value="{{userProfile.phonenumber}}" (ionChange)="profileChange($event, 'phonenumber')">
        </ion-input>
      </ion-item>
      <!--
      <ion-item detail="true" (click)="changeEmail(userProfile.email)">
        <ion-input labelPlacement="stacked" [label]='"profile.email" | translate' email
          attr.aria-label='{{"profile.email" | translate}}' readonly [(ngModel)]="userProfile.email"
          value="{{userProfile.email}}">
        </ion-input>
      </ion-item> -->

      <ion-item id="present-alert-email" detail="true">
        <ion-input labelPlacement="stacked" [label]='"profile.email" | translate' type="email"
          attr.aria-label='{{"profile.email" | translate}}' readonly 
          [value]="userProfile.email">
        </ion-input>
      </ion-item>

      <ion-alert trigger="present-alert-email" [header]='"profile.change_email_header" | translate'
        [message]='"profile.change_email_message" | translate' [buttons]="alertButtonsEmail"
        [inputs]="alertInputsEmail"></ion-alert>


      <!--<ion-item (click)="changeAddress(userProfile)" detail="true">
        <ion-input labelPlacement="stacked" [label]='"profile.address" | translate'
          attr.aria-label='{{"profile.address" | translate}}'
          value="{{userProfile.streetAndNumber}}, {{userProfile.postalcode}} {{userProfile.city}}">
        </ion-input>
      </ion-item>-->

      <ion-item id="present-alert-address" detail="true">
        <ion-input labelPlacement="stacked" [label]='"profile.address" | translate'
          attr.aria-label='{{"profile.address" | translate}}'
          value="{{userProfile.streetAndNumber}}, {{userProfile.postalcode}} {{userProfile.city}}">
        </ion-input>
      </ion-item>
      <ion-alert trigger="present-alert-address" [header]='"profile.change_address_header" | translate'
        [message]='"profile.change_address_message" | translate' [buttons]="alertButtonsAddress"
        [inputs]="alertInputsAddress"></ion-alert>

    </ion-list>

    <ion-list lines="full" [inset]="true">
      <ion-list-header>
        <ion-label> {{ "profile.sport" | translate}} </ion-label>
      </ion-list-header>

      <ion-item>
        <ion-input labelPlacement="stacked" [label]='"profile.license__number" | translate'
          attr.aria-label='{{"profile.license__number" | translate}}'
          (ionChange)="profileChange($event, 'licenseNumber')" [(ngModel)]="userProfile.licenseNumber"
          value="{{userProfile.licenseNumber}}">
        </ion-input>
      </ion-item>
    </ion-list>

    <ion-list lines="full" [inset]="true">
      <ion-list-header>
        <ion-label> {{ "profile.diverses" | translate}} </ion-label>
      </ion-list-header>

      <ion-item detail="true" (click)="openHelferPunkte()">
        <ion-icon name="help-buoy-outline" slot="start"></ion-icon>
        <ion-label> {{ "common.helper_points" | translate}} </ion-label>
      </ion-item>
    </ion-list>

    <!--
    <ion-list *ngIf="clubRequestList.length > 0" lines="full" [inset]="true">
      <ion-list-header>
        <ion-label>
          {{ "profile.open__club_inquiry" | translate}}
        </ion-label>
      </ion-list-header>
      <ion-item *ngFor="let request of clubRequestList">
        <ion-label>
          {{request.name}}
        </ion-label>
        <ion-button color="danger" (click)="deleteClubRequest(request)" slot="end">
          <ion-icon icon-only name="trash"></ion-icon>
        </ion-button>
      </ion-item>
    </ion-list>-->

    <!--<ion-list *ngIf="teamRequestList.length > 0" lines="full" [inset]="true">
      <ion-list-header>
        <ion-label>
          {{"profile.open__team_request" | translate}}
        </ion-label>
      </ion-list-header>
      <ion-item *ngFor="let request of teamRequestList">
        <ion-label>
          {{request.liga}} {{request.name}}
        </ion-label>
        <ion-button color="danger" (click)="deleteTeamRequest(request)" slot="end">
          <ion-icon icon-only name="trash"></ion-icon>
        </ion-button>
      </ion-item>
    </ion-list>-->
    <ion-list lines="full" [inset]="true">
      <ion-list-header>
        <ion-label> {{"profile.notifications" | translate}} </ion-label>
      </ion-list-header>
      <!--
     <ion-item>
       <ion-label position="stacked"> Meine Ger√§te Id </ion-label>
       <ion-input readonly value="{{deviceId.uuid}}"></ion-input>
      </ion-item>
    -->
      <ion-accordion-group>
        <ion-accordion value="settingsPush">
          <ion-item slot="header">
            <ion-icon slot="start" color="primary" name="notifications-outline"></ion-icon>
            <ion-label> {{"profile.push__message" | translate}} </ion-label>
          </ion-item>
          <div slot="content">
            <ion-item>
              <ion-icon *ngIf="userProfile.settingsPush" slot="start" color="success"
                name="notifications-circle"></ion-icon>
              <ion-icon *ngIf="!userProfile.settingsPush" slot="start" color="danger"
                name="notifications-off-circle"></ion-icon>

              <ion-toggle attr.aria-label='{{"profile.push__message" | translate}}'
                value="{{userProfile?.settingsPush}}" [checked]="userProfile.settingsPush" [enableOnOffLabels]="true"
                (ionChange)="togglePush($event)">
                <ion-label>
                  {{"profile.push__message__activate" | translate}}
                </ion-label>
                <ion-note class="ion-text-wrap" *ngIf="userProfile.settingsPush" color="medium">
                  {{"profile.push__message__deactivate" |
                  translate}}</ion-note>

              </ion-toggle>

            </ion-item>
            <ion-item disabled="{{!userProfile.settingsPush}}">
              <ion-icon size="small" slot="start" name="newspaper-outline"></ion-icon>
              <ion-toggle labelPlacement="start" attr.aria-label='{{"common.news" | translate}}'
                value="{{userProfile?.settingsPushNews}}" slot="end" [checked]="userProfile.settingsPushNews"
                [enableOnOffLabels]="true" (ionChange)="togglePushModule($event, 'News')"></ion-toggle>
              <ion-label> {{"common.news" | translate}} </ion-label>
            </ion-item>

            <!-- TODO ADD CHECK FOR CLUB-->
            <ion-item  disabled="{{!userProfile.settingsPush}}">
              <ion-icon size="small" slot="start" name="newspaper"></ion-icon>
              <ion-toggle labelPlacement="start" attr.aria-label='{{"common.newsVerband" | translate}}'
                value="{{userProfile?.settingsPushNewsVerband}}" slot="end" [checked]="userProfile.settingsPushNewsVerband"
                [enableOnOffLabels]="true" (ionChange)="togglePushModule($event, 'NewsVerband')"></ion-toggle>
              <ion-label> {{"common.newsVerband" | translate}} </ion-label>
            </ion-item>

            <ion-item disabled="{{!userProfile.settingsPush}}">
              <ion-icon size="small" slot="start" name="barbell-outline"></ion-icon>
              <ion-toggle labelPlacement="start" attr.aria-label='{{"common.training" | translate}}'
                value="{{userProfile?.settingsPushTraining}}" slot="end" [checked]="userProfile.settingsPushTraining"
                [enableOnOffLabels]="true" (ionChange)="togglePushModule($event, 'Training')"></ion-toggle>
              <ion-label> {{"common.training" | translate}} </ion-label>
            </ion-item>

            <ion-item disabled="{{!userProfile.settingsPush}}">
              <ion-icon size="small" slot="start" name="trophy-outline"></ion-icon>
              <ion-toggle labelPlacement="start" attr.aria-label='{{"common.championship" | translate}}'
                value="{{userProfile?.settingsPushChampionship}}" slot="end"
                [checked]="userProfile.settingsPushChampionship" [enableOnOffLabels]="true"
                (ionChange)="togglePushModule($event, 'Championship')"></ion-toggle>
              <ion-label> {{"common.championship" | translate}} </ion-label>
            </ion-item>

            <ion-item disabled="{{!userProfile.settingsPush}}">
              <ion-icon size="small" slot="start" name="calendar-outline"></ion-icon>
              <ion-toggle labelPlacement="start" attr.aria-label='{{"common.events" | translate}}'
                value="{{userProfile?.settingsPushEvent}}" slot="end" [checked]="userProfile.settingsPushEvent"
                [enableOnOffLabels]="true" (ionChange)="togglePushModule($event, 'Event')"></ion-toggle>
              <ion-label> {{"common.events" | translate}} </ion-label>
            </ion-item>

            <ion-item disabled="{{!userProfile.settingsPush}}">
              <ion-icon size="small" slot="start" name="help-buoy-outline"></ion-icon>
              <ion-toggle labelPlacement="start" attr.aria-label='{{"common.helper" | translate}}'
                value="{{userProfile?.settingsPushHelfer}}" slot="end" [checked]="userProfile.settingsPushHelfer"
                [enableOnOffLabels]="true" (ionChange)="togglePushModule($event, 'Helfer')"></ion-toggle>
              <ion-label> {{"common.helper" | translate}} </ion-label>
            </ion-item>
          </div>
        </ion-accordion>

        <ion-accordion value="settingsEmail">
          <ion-item slot="header">
            <ion-icon slot="start" color="secondary" name="mail-outline"></ion-icon>
            <ion-label> {{"profile.email__messages" | translate}} </ion-label>
          </ion-item>
          <div slot="content">
            <ion-item>
              <ion-icon *ngIf="userProfile.settingsEmail" slot="start" color="success" name="mail"></ion-icon>
              <ion-icon *ngIf="!userProfile.settingsEmail" slot="start" color="danger" name="mail-outline"></ion-icon>

              <ion-toggle color="secondary" attr.aria-label='{{"profile.email__messages" | translate}}'
                value="{{userProfile?.settingsEmail}}" [checked]="userProfile.settingsEmail" [enableOnOffLabels]="true"
                (ionChange)="toggleEmail($event)">
                <ion-label> {{"profile.email__messages" | translate}} </ion-label>
              </ion-toggle>
            </ion-item>
            <ion-item>
              <ion-icon slot="start" size="small" name="analytics"></ion-icon>
              <ion-toggle color="secondary" labelPlacement="start"
                attr.aria-label='{{"profile.email__messages_report" | translate}}'
                value="{{userProfile?.settingsEmailReporting}}" slot="end"
                [checked]="userProfile.settingsEmailReporting" [enableOnOffLabels]="true"
                (ionChange)="toggleEmailReporting($event)"></ion-toggle>
              <ion-label>
                {{"profile.email__messages_report" | translate}}
              </ion-label>
            </ion-item>
          </div>
        </ion-accordion>
      </ion-accordion-group>
    </ion-list>

    <!-- <ion-list lines="full" [inset]="true">
      <ion-list-header>
        {{"profile.push__notifications" | translate}}
      </ion-list-header>
      <ion-accordion-group *ngIf="pushDeviceList.length > 0">
        <ion-accordion value="pushDeviceList">
          <ion-item slot="header" color="light">
            <ion-label>{{"profile.push__notifications_devices" | translate}}</ion-label>
          </ion-item>
          <div class="ion-padding" slot="content">
            <ion-list>
              <ion-item *ngFor="let device of pushDeviceList">
                <ion-input labelPlacement="stacked" label="Model {{device?.model}}" aria-label="device?.model" readonly
                  value="Id: {{device?.id}}"></ion-input>
                <ion-button color="danger" (click)="deletePushDevice(device.id)">
                  <ion-icon slot="icon-only" name="trash"> </ion-icon>
                </ion-button>
                <ion-badge slot="end" *ngIf="device.id==deviceId.identifier">{{"profile.current__device" |
                  translate}}</ion-badge>
              </ion-item>
            </ion-list>
          </div>
        </ion-accordion>
      </ion-accordion-group>

      <ion-item>
        <ion-button (click)="registerDevice()"> {{"profile.push__registeration" | translate}} </ion-button>
      </ion-item>
    </ion-list>-->
    <!-- <ion-item>
      <ion-button (click)="registerDevice()"> {{"profile.push__registeration" | translate}} </ion-button>
    </ion-item> -->

    <!--<ion-list lines="full" [inset]="true">
      <ion-item>
        <ion-label color="danger">{{'profile.delete__profile' | translate}}</ion-label>
        <ion-button slot="end" color="danger" (click)="deleteProfile()">
          <ion-icon slot="icon-only" name="trash"> </ion-icon>
        </ion-button>
      </ion-item>

    </ion-list>-->
    <div class="ion-padding">
      <ion-button fill="outline" expand="block" color="danger" (click)="deleteProfile()">
        <ion-icon slot="start" name="trash"></ion-icon>
        {{'profile.delete__profile' | translate}}
      </ion-button>
    </div>
  </ng-container>
 

  <!-- 
  <ng-container *ngIf="clubList$ | async as clubList; else loadingClub">
    <ion-list>
      <ion-list-header>
        <ion-label>
          Meine Clubs
        </ion-label>
        <ion-button>
          <ion-icon slot="icon-only" name="add"></ion-icon>
        </ion-button>
      </ion-list-header>
      <ion-item *ngFor="let club of clubList">
        <ion-label>
          {{club.id}}
        </ion-label>
        <ion-button slot="end">
          <ion-icon slot="icon-only"  color="danger" name="remove-circle-outline"></ion-icon>
        </ion-button>
      </ion-item>
    </ion-list>
  </ng-container>

  <ng-container *ngIf="teamList$ | async as teamList; else loadingTeams">
    <ion-list>
      <ion-list-header>
        <ion-label>
          Meine Teams
        </ion-label>
        <ion-button >
          <ion-icon slot="icon-only" name="add"></ion-icon>
        </ion-button>
      </ion-list-header>
      <ion-item *ngFor="let team of teamList">
        <ion-label>
         {{team.id}}
        </ion-label>
        <ion-button slot="end">
          <ion-icon slot="icon-only"   color="danger" name="remove-circle-outline"></ion-icon>
        </ion-button>
      </ion-item>
    </ion-list>
  </ng-container>
-->
</ion-content>
<ng-template #loading>
  <!-- Bubbles -->
  <ion-spinner name="bubbles"></ion-spinner>
</ng-template>

<ng-template #loadingClub>
  <ion-text> {{"common.loading" | translate}} </ion-text>
</ng-template>

<ng-template #loadingTeams>
  <ion-text> {{"common.loading" | translate}} </ion-text>
</ng-template>